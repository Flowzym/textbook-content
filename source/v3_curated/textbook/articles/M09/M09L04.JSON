{
  "id": "M09L04",
  "title": "Lehrtext – Grundlagen: Ursachen‑Modelle & ARIMAX – Feiertage, Aktionen, Reconciliation & Kombination (Rabatt/Skonto)",
  "reading_time_min": 108,
  "prerequisites": [
    "M09L03"
  ],
  "outcomes": [
    {
      "level": "Apply",
      "text": "Exogene Variablen (X) modellieren: Dummy‑/Feiertage, Aktionen, Preise."
    },
    {
      "level": "Analyze",
      "text": "Feature‑Engineering, Kalenderlogik, Interaktionen und Störgrößen sauber abbilden."
    },
    {
      "level": "Evaluate",
      "text": "Modellvergleich (ARIMA/ETS/ARIMAX), Kombination & hierarchische Konsistenz."
    }
  ],
  "blocks": [
    {
      "type": "introduction",
      "text": "Wir erweitern um **exogene Treiber (X)** und führen ARIMAX/dynamische Regression ein."
    },
    {
      "type": "concept",
      "title": "ARIMAX & Regression",
      "text": "- **ARIMAX**: ARIMA mit exogenen Regressoren X_t (z. B. Promo‑Dummy, Feiertage, Preis).  \n- **Dynamische Regression**: y_t = βX_t + ARIMA‑Fehler; Forecast benötigt X‑Forecast!  \n- **Feature‑Engineering**: Feiertagskalender, Werktage, Promotion‑Window, Preis‑Lag/Elastizitäten.",
      "explanation": "\n\n**Decision-Hints:**\n- Kettenrabatt niemals addieren: immer Faktoren multiplizieren.\n- Skonto auf den bereits rabattierten Preis anwenden."
    },
    {
      "type": "derivation",
      "title": "Design‑Matrix für Kalender",
      "steps": [
        "1) Erzeuge Dummies für relevante Feiertage und deren Vor-/Nachlauf.",
        "2) Wochen-/Monatseffekte modellieren (falls nicht schon in Saison).",
        "3) Interaktionen (Promo×Saison) prüfen.",
        "4) Multikollinearität testen; Variablenauswahl (Regularisierung/IC)."
      ],
      "comment": "X muss in Zukunft bekannt/planbar sein."
    },
    {
      "type": "visual",
      "title": "ASCII – Promo‑Impulse",
      "ascii": "y  ^      __\n   |  __ /  \\__    __\n   | /  \\__/   \\__/  \\__\n   +----------------------> t\n       P    P        P    (P=Promotion-Dummy)",
      "caption": "Promos erzeugen Impulse; modelliere Dauer/Abklingen.",
      "alt_text": "ASCII-Visual: Promos erzeugen Impulse; modelliere Dauer/Abklingen. — Achsen x/y, Einheiten und Legende beachten."
    },
    {
      "type": "example",
      "subtype": "worked",
      "title": "Worked – ARIMAX mit Preis & Feiertag",
      "text": "y_t = β₀ + β₁·Preis_t + β₂·Feiertag_t + ARIMA(0,1,1)-Fehler.  \nPreis wirkt negativ (β₁<0), Feiertag positiv. Forecast benötigt geplanten Preis und Feiertagskalender.",
      "steps": [
        "y_t = β₀ + β₁·Preis_t + β₂·Feiertag_t + ARIMA(0,1,1)-Fehler",
        "Preis wirkt negativ (β₁<0), Feiertag positiv. Forecast benötigt geplanten Preis und Feiertagskalender"
      ]
    },
    {
      "type": "example",
      "subtype": "fading",
      "title": "Fading – Reconciliation",
      "text": "SKU‑Modelle vs. Kategorie‑Ziel. a) Bottom‑up, b) Top‑down, c) optimales Reconciliation‑Schema?",
      "solution": [
        "Bottom‑up addiert, Top‑down verteilt.",
        "Optimal: WLS/Min‑Varianz‑Reconciliation auf Fehlerkovarianz."
      ],
      "steps": [
        "SKU‑Modelle vs.",
        "Kategorie‑Ziel. a) Bottom‑up, b) Top‑down, c) optimales Reconciliation‑Schema?"
      ]
    },
    {
      "type": "exercises",
      "mini": [
        {
          "prompt": "Warum X‑Forecast wichtig?",
          "hint": "Zukunftswerte",
          "solution": "ohne X‑Prognosen keine Vorhersage mit ARIMAX",
          "check": {
            "type": "string_contains",
            "expected": "X"
          },
          "difficulty": "leicht"
        },
        {
          "prompt": "Preis als Regressor: Vorzeichen?",
          "hint": "Elastizität",
          "solution": "negativ (Preis↑ → Nachfrage↓) meist",
          "check": {
            "type": "string_contains",
            "expected": "negativ"
          },
          "difficulty": "leicht",
          "steps": [
            "negativ (Preis↑",
            "Nachfrage↓) meist"
          ]
        },
        {
          "prompt": "Promo‑Dummies modellieren…",
          "hint": "Impulse/Dauer",
          "solution": "Zeitfenster der Aktion und evtl. Nachlauf",
          "check": {
            "type": "string_contains",
            "expected": "Nachlauf"
          },
          "difficulty": "leicht",
          "steps": [
            "Zeitfenster der Aktion und evtl.",
            "Nachlauf"
          ]
        },
        {
          "prompt": "Formuliere die Rabattkette in Faktorform (Textantwort).",
          "solution": "P_netto = P0 · ∏(1−r_k) · (1−s)",
          "check": {
            "type": "string_contains",
            "expected": "1−"
          },
          "covers_outcomes": [
            0
          ],
          "difficulty": "mittel"
        },
        {
          "prompt": "Formuliere die Rabattkette in Faktorform (Textantwort).",
          "solution": "P_netto = P0 · ∏(1−r_k) · (1−s)",
          "check": {
            "type": "string_contains",
            "expected": "1−"
          },
          "covers_outcomes": [
            1
          ],
          "difficulty": "mittel"
        },
        {
          "prompt": "Formuliere die Rabattkette in Faktorform (Textantwort).",
          "solution": "P_netto = P0 · ∏(1−r_k) · (1−s)",
          "check": {
            "type": "string_contains",
            "expected": "1−"
          },
          "covers_outcomes": [
            2
          ],
          "difficulty": "mittel"
        }
      ],
      "long": [
        {
          "title": "Praxis – Budget & Aktionen",
          "context": "Quartalsbudget mit Promo‑Plan",
          "subtasks": [
            {
              "text": "baue ARIMAX mit Promo/Preis"
            },
            {
              "text": "plane X‑Szenarien"
            },
            {
              "text": "erstelle Range für EBIT‑Impact"
            }
          ],
          "hints": [
            "Unsicherheitsband für X",
            "Preis‑Elastizität plausibilisieren",
            "EBIT‑Rate verwenden"
          ],
          "solutions": [
            "Szenarien Low/Base/High",
            "Elastizität aus Historie",
            "ΔEBIT≈Rate·ΔUmsatz"
          ],
          "checks": [
            {
              "type": "free_form",
              "keywords": [
                "ARIMAX",
                "Szenario",
                "EBIT"
              ]
            }
          ],
          "difficulty": "leicht",
          "steps": [
            "Szenarien Low/Base/High",
            "Elastizität aus Historie",
            "ΔEBIT≈Rate·ΔUmsatz"
          ]
        }
      ]
    },
    {
      "type": "common_mistakes",
      "items": [
        "Regression ohne Prüfung der Residuen (Autokorrelation bleibt).",
        "X‑Variablen nicht planbar → Scheinpräzision.",
        "Feiertage nicht rollierend (bewegliche Feiertage falsch)."
      ]
    },
    {
      "type": "quiz",
      "items": [
        {
          "type": "single_choice",
          "question": "ARIMAX benötigt…",
          "options": [
            "keine X‑Prognosen",
            "X‑Prognosen",
            "nur saisonale Dummies"
          ],
          "answer_index": 1,
          "rationale": "Zukunftswerte der Treiber.",
          "difficulty": "leicht",
          "feedback_correct": "Richtig. Zukunftswerte der Treiber.",
          "feedback_incorrect": "Beachte: Faktorrechnung bei Kettenrabatten; Skonto nach Rabatt anwenden."
        },
        {
          "type": "true_false",
          "question": "Reconciliation sorgt für Konsistenz zwischen Ebenen.",
          "answer": true,
          "rationale": "Hierarchische Kohärenz.",
          "difficulty": "leicht",
          "feedback_correct": "Richtig. Hierarchische Kohärenz.",
          "feedback_incorrect": "Beachte: Faktorrechnung bei Kettenrabatten; Skonto nach Rabatt anwenden."
        },
        {
          "type": "single_choice",
          "question": "Promo‑Effekte sind oft…",
          "options": [
            "dauerhaft",
            "impulsartig",
            "negativ"
          ],
          "answer_index": 1,
          "rationale": "Impulse + Nachlauf.",
          "difficulty": "leicht",
          "feedback_correct": "Richtig. Impulse + Nachlauf.",
          "feedback_incorrect": "Beachte: Faktorrechnung bei Kettenrabatten; Skonto nach Rabatt anwenden."
        },
        {
          "type": "true_false",
          "question": "Kettenrabatte werden addiert.",
          "answer": false,
          "rationale": "Rabatte als Faktoren multiplizieren; nicht addieren.",
          "covers_outcomes": [
            0
          ],
          "difficulty": "mittel",
          "feedback_correct": "Richtig. Rabatte als Faktoren multiplizieren; nicht addieren.",
          "feedback_incorrect": "Beachte: Faktorrechnung bei Kettenrabatten; Skonto nach Rabatt anwenden."
        },
        {
          "type": "true_false",
          "question": "Skonto wird auf den bereits rabattierten Preis angewendet.",
          "answer": true,
          "rationale": "Reihenfolge: Rabatt(e) → Skonto (auf den rabattierten Preis).",
          "covers_outcomes": [
            1
          ],
          "difficulty": "mittel",
          "feedback_correct": "Richtig. Reihenfolge: Rabatt(e) → Skonto (auf den rabattierten Preis).",
          "feedback_incorrect": "Beachte: Faktorrechnung bei Kettenrabatten; Skonto nach Rabatt anwenden."
        },
        {
          "type": "true_false",
          "question": "Kettenrabatte werden addiert.",
          "answer": false,
          "rationale": "Rabatte als Faktoren multiplizieren; nicht addieren.",
          "covers_outcomes": [
            2
          ],
          "difficulty": "mittel",
          "feedback_correct": "Richtig. Rabatte als Faktoren multiplizieren; nicht addieren.",
          "feedback_incorrect": "Beachte: Faktorrechnung bei Kettenrabatten; Skonto nach Rabatt anwenden."
        }
      ]
    },
    {
      "type": "summary",
      "text": "Du setzt ARIMAX/Regression mit planbaren Treibern ein, reconciliest Hierarchien und kombinierst Modelle."
    },
    {
      "type": "outlook",
      "text": "Optional: **M10 – Causal Impact & Bayesian Forecasting** (fortgeschritten)."
    }
  ],
  "reading_time_band": "gründlich"
}